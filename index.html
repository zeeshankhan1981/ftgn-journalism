<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FTGN Journalism</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">
  <style>
    body {{
      font-family: 'Merriweather', serif;
      background: #1a1a1a;
      color: #f0f0f0;
      max-width: 900px;
      margin: auto;
      padding: 2rem;
    }}
    h1, h2 {{
      color: #ffffff;
    }}
    label, select, input {{
      font-size: 1rem;
      margin-right: 1rem;
    }}
    .result-item {{
      margin: 1rem 0;
    }}
    a {{
      color: #4ea3ff;
      text-decoration: none;
    }}
    a:hover {{
      text-decoration: underline;
    }}
    .lang-switch {{
      margin-top: 1rem;
    }}
    .light-mode {{
      background: #ffffff;
      color: #111;
    }}
    .toggle {{
      margin: 1rem 0;
    }}
  </style>
  <script src="https://unpkg.com/lunr/lunr.js"></script>
</head>
<body>
  <h1>FTGN Journalism</h1>
  <div class="toggle">
    <button onclick="toggleMode()">ðŸŒ“ Toggle Light/Dark Mode</button>
  </div>
  <div>
    <label for="search">Search:</label>
    <input type="text" id="search" onkeyup="searchEssays()" placeholder="Enter keywords...">
    <label for="yearFilter">Year:</label>
    <select id="yearFilter" onchange="searchEssays()">
      <option value="">All</option>
    </select>
    <label for="locationFilter">Location:</label>
    <select id="locationFilter" onchange="searchEssays()">
      <option value="">All</option>
    </select>
    <label for="themeFilter">Theme:</label>
    <select id="themeFilter" onchange="searchEssays()">
      <option value="">All</option>
      <option value="civilian">Civilian</option>
    </select>
  </div>
  <div id="results"></div>
  <div class="lang-switch">
    <label>Language:</label>
    <select onchange="switchLanguage(this.value)">
      <option value="en" selected>English</option>
      <option value="fr">FranÃ§ais</option>
    </select>
  </div>
  <script>
    let essays = [];
    let idx;

    fetch("essays/metadata.json")
      .then(response => response.json())
      .then(data => {{
        essays = data;
        populateFilters();
        buildIndex();
        displayResults(data);
      }});

    function populateFilters() {{
      const yearSet = new Set();
      const locSet = new Set();
      essays.forEach(e => {{
        yearSet.add(e.year);
        locSet.add(e.location);
      }});
      yearSet.forEach(y => {{
        const opt = document.createElement("option");
        opt.value = y; opt.textContent = y;
        document.getElementById("yearFilter").appendChild(opt);
      }});
      locSet.forEach(l => {{
        const opt = document.createElement("option");
        opt.value = l; opt.textContent = l;
        document.getElementById("locationFilter").appendChild(opt);
      }});
    }}

    function buildIndex() {{
      idx = lunr(function () {{
        this.ref('filename');
        this.field('title');
        this.field('year');
        this.field('location');
        this.field('theme');
        essays.forEach(e => this.add(e));
      }});
    }}

    function searchEssays() {{
      const query = document.getElementById("search").value;
      const year = document.getElementById("yearFilter").value;
      const location = document.getElementById("locationFilter").value;
      const theme = document.getElementById("themeFilter").value;
      let results = idx.search(query ? query : "*");
      let filtered = results.map(r => essays.find(e => e.filename === r.ref));
      if (year) filtered = filtered.filter(e => e.year === year);
      if (location) filtered = filtered.filter(e => e.location === location);
      if (theme) filtered = filtered.filter(e => e.theme === theme);
      displayResults(filtered);
    }}

    function displayResults(items) {{
      const container = document.getElementById("results");
      container.innerHTML = items.map(function(e) {{
        return "<div class='result-item'><a href='essays/en/" + e.filename.replace(".md", ".html") + "'>" + e.title + "</a> (" + e.year + ")</div>";
      }}).join("");
    }}

    function toggleMode() {{
      document.body.classList.toggle("light-mode");
    }}

    function switchLanguage(lang) {{
      alert("Multilingual content loading not implemented. Placeholder for: " + lang);
    }}
  </script>
</body>
</html>
